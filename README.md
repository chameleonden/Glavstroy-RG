# Скрипт проверки статусов внутренних номеров

Bash скрипт для проверки статусов внутренних номеров через HTTPS API и фильтрации номеров со статусом "В офисе".

## Файлы

- `check_status.sh` - Bash скрипт

## Требования

- `bash`
- `curl`
- `xmlstarlet` или `xmllint` (для парсинга XML)

Установка зависимостей:
```bash
# Для xmlstarlet (рекомендуется)
sudo apt-get install xmlstarlet

# Или для xmllint
sudo apt-get install libxml2-utils
```

## Настройка

### 1. Установите URL API в скрипте

Откройте файл `check_status.sh` и измените переменную `DEFAULT_API_URL` на строке 9:

```bash
DEFAULT_API_URL="https://your-api-url.com/api/users"
```

Замените `https://your-api-url.com/api/users` на реальный адрес вашего API.

**Альтернативно:** можно установить переменную окружения `API_URL`, которая переопределит значение по умолчанию:

```bash
export API_URL='https://your-api-url.com/api/users'
```

### 2. Сделайте скрипт исполняемым (если еще не сделано):

```bash
chmod +x check_status.sh
```

## Использование

### Передача номеров как аргументы:

```bash
./check_status.sh 3820 3187 3801 3228
```

### Передача номеров через stdin:

```bash
echo "3820 3187 3801" | ./check_status.sh
```

### Использование с файлом:

```bash
# Создайте файл numbers.txt с номерами (через пробел или запятую)
echo "3820 3187 3801" > numbers.txt

cat numbers.txt | ./check_status.sh
```

## Формат вывода

Скрипт выводит только номера со статусом "В офисе" в формате:

```
3801#-3802#-3804#-3805#-3806#-3807#-3809#-3811#
```

- Номера разделены через `#-`
- После последнего номера ставится `#`
- Номера сортируются по возрастанию
- Если номера со статусом "В офисе" не найдены, скрипт ничего не выводит

## Примеры

### Проверка одного номера:
```bash
./check_status.sh 3820
```

### Проверка нескольких номеров:
```bash
./check_status.sh 3820 3187 3801 3228 3802
```

### Отладочный режим:

Для диагностики проблем можно включить отладочный режим:

```bash
DEBUG=1 ./check_status.sh 3820 3187 3801
```

Отладочный режим покажет:
- URL запроса
- HTTP код ответа
- Размер ответа
- Какие номера ищутся
- Найденные номера и их статусы

## Обработка ошибок

Скрипт обрабатывает следующие ошибки:
- Отсутствие URL API (или значение по умолчанию не изменено)
- Отсутствие номеров для проверки
- Ошибки HTTP запроса
- Ошибки парсинга XML
- Отсутствие необходимых утилит (curl, xmlstarlet/xmllint)

При ошибках скрипт выводит сообщения в stderr и завершается с кодом ошибки.

## Структура XML ответа

Скрипт ожидает XML ответ в следующем формате:

```xml
<users>
  <user>
    <fullname>Имя Фамилия</fullname>
    <address1_telephone1>3801</address1_telephone1>
    <tisa_useraccessibilitycode>В офисе</tisa_useraccessibilitycode>
  </user>
  ...
</users>
```

Скрипт фильтрует пользователей по полю `address1_telephone1` и выводит только те номера, у которых `tisa_useraccessibilitycode` равен "В офисе".